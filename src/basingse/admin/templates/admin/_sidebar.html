{% set active_endpoint = active_endpoint | default(request.endpoint) %}

<div class="position-fixed start-0 d-flex vh-100">
    <div class="d-flex flex-column flex-shrink-0 px-3 bg-light" style="width: 280px">
        <div class="my-3 mx-auto">
            {% include "_devbar.html" %}
        </div>
        <a href="/" class="d-flex align-items-center mb-3 mb-md-0 me-md-auto link-dark text-decoration-none">
            <img src="{{ url_for('customize.logo', size='small') }}" width=40 class="rounded-circle mx-2" />
            <span class="fs-4">{{ site_settings.title }}</span>
        </a>
        <hr>
        <ul class="nav nav-pills flex-column mb-auto" data-endpoint="{{ active_endpoint }}">

            {% macro nav_item(title, endpoint, iconname, capability) %}
            {% if (not capability) or current_user.can(capability) %}
            <li class="nav-item">
                <a href="{{ url_for(endpoint) }}"
                    class="nav-link {% if active_endpoint == endpoint %}active{% else %}link-dark{% endif %}" {% if
                    active_endpoint==endpoint %}aria-current="page" {% endif %}>
                    <div class="pe-2 d-inline-flex align-items-center">
                        {{ icon(iconname, classes="me-2") }}
                        {{title}}
                    </div>
                </a>
            </li>
            {% endif %}
            {% endmacro %}
            {{ nav_item("Home", "admin.home", "house-door-fill") }}
            {{ nav_item("Settings", "customize.admin.edit", "gear", "settings.edit" )}}
            {{ nav_item("Episodes", "admin.episode.list", "cassette", "episode.view") }}
            {{ nav_item("Cast", "admin.castmember.list", "people-fill", "castmember.view") }}
            {{ nav_item("Characters", "admin.character.list", "person-rolodex", "character.view") }}
            {{ nav_item("Pages", "admin.page.list", "file-text", "page.view") }}
            {{ nav_item("Attachments", "admin.attachment.list", "file-earmark", "attachment.view") }}
            {{ nav_item("Users", "admin.user.list", "person-badge", "user.view") }}
            {{ nav_item("Feature Flags", "maintenance.flags", "flag", "maintenance.view") }}
            {{ nav_item("Maintenance", "maintenance.home", "tools", "maintenance.view") }}
        </ul>
        <hr>
        {% if current_user.is_authenticated %}
        <div class="dropdown mb-3">
            <a href="#" class="d-flex align-items-center link-dark text-decoration-none dropdown-toggle "
                id="dropdownUser2" data-bs-toggle="dropdown" aria-expanded="false">
                {{ icon("person-circle", height=32, width=32, classes="me-2")}}
                <strong>{{ current_user.displayname }}</strong>
            </a>
            <ul class="dropdown-menu text-small shadow" aria-labelledby="dropdownUser2">
                <li><a class="dropdown-item" href="{{ url_for('auth.password') }}">Password</a></li>
                <li>
                    <hr class="dropdown-divider">
                </li>
                <li><a class="dropdown-item" href="{{ url_for('auth.logout') }}">Sign out</a></li>
            </ul>
        </div>
        {% else %}
        <div class="mb-3">
            <a href="{{ url_for('auth.login') }}" class="d-flex align-items-center link-dark text-decoration-none">
                {{ icon("lock", height=32, width=32, classes="me-2")}}
                <strong>Login</strong>
            </a>
        </div>
        {% endif %}
    </div>
</div>
